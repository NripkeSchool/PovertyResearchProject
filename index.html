<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Depressing Table</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div id="main-title">
        <h1> Poverty in American School Districts</h1>
        <p> <em> Brought to you by the US Census Bureau </em></p>
    </div>
	<div id="test">
	</div>
    <form id="search" onSubmit="myFunction()">
        <label for="search-column">In Column:</label>
        <select name="column" id="search-column">
            <option value="state">State</option>
            <option value="fips">State FIPS Code</option>
            <option value="dist-id">District ID</option>
            <!--Add remaining options-->
        </select>
        <label for="searchfor">Search for </label>
        <input id="searchfor" type="text" />
        <select name="scope" id="search-scope">
            <option value="exact">Matches Exactly</option>
            <option value="contains">Contains</option>
            <option value="not-conains">Does Not Contain</option>
        </select>
    <input type="submit" id="submit-search" />
	<select name="Table Size" id="table-size" onchange="changeSize()">
            <option value="10">10 Rows</option>
            <option value="25">25 Rows</option>
            <option value="50">50 Rows</option>
    </select>
    </form>
	<button class="buttons" onclick="lastPage()"> Show Last Page </button>
	<button class="buttons" onclick="nextPage()"> Show Next Page </button>
  <table>
      <thead class="HEADER">
          <tr>
              <a href="#" onclick="sortBy(0)"><th>State</th></a>
              <th>State FIPS Code</th>
              <th>District ID</th>
              <th>Name</th>
              <th>Total Population</th>
              <th>School-aged population (5-17)</th>
              <th>School-aged children in poverty</th>
              <th>Poverty Rate</th>
          </tr>
      </thead>
      <tbody id="data-table">
      </tbody>
  </table>
</body>
    <script>
		let table = document.getElementById("data-table");
		let size = 10;
		let topPos = 0;
		const information = {
			state: [],
			sCode: [],
			dID: [],
			name: [],
			totalPop: [],
			kidPop: [],
			povNum: [],
			povRate: []
		};
		const allInformation = [information.state, information.sCode, information.dID, information.name, information.totalPop, information.kidPop, information.povNum, information.povRate];
		
		let displayInfo = []; 
		
		function sortNum(array)
		{
			const index = [];
			
			for (let i = 0; i<array.length; i++)
			{
				let smallIndex = 0;
				
				for (let j = 0; j<array.length; j++)
				{
					if (array[j] == -1) {continue;}
					if (array[j] < array[smallest])
					{
						smallIndex = j;
					}
				}
				index.push(smallIndex);
				array[smallIndex] = -1;
			}
			
			return index;
		}
		
		function loadDoc() {
			const xhttp = new XMLHttpRequest();
			xhttp.onload = function() {
				readFile(this.responseText.split("\n"));
			}
			xhttp.open("GET", "DATA.txt", false);
			xhttp.send();
		};
		
		function readFile(message) {
			for (let i = 0; i<message.length; i++)
			{
				let info = message[i].split(",");
				
				for (let j = 0; j<info.length; j++)
				{
					allInformation[j].push(info[j]);
				}
				allInformation[7][i] = ((allInformation[6][i] / allInformation[5][i])*100).toFixed(2);
			}
		};
		
		function sortBy(category)
		{
		// 
			switch(category)
			{
				case 0:
					
					break;
				case 1:
					displayInfo[1] = information.sCode.sort(function(a,b){return b-a;});
					break;
				case 2:
					
					break;
				case 3:
				
					break;
				case 4:
				
					break;
				case 5:
				
					break;
				case 6:
					break;
				case 7:
					break;
			}
		}
		
		function nextPage()
		{
			if (topPos+size >= displayInfo.length) {return;}
			topPos += size;
			DESTROY();
			createTable();
		};
		
		function lastPage()
		{
			if (topPos-size < 0) {topPos = 0;}else {topPos -= size;}
			DESTROY();
			createTable();
		};
		
        function createTable() {
		    for (let times = 0; times<size; times++)
			{
				let position = topPos+times;
				if (position >= displayInfo[0].length)
				{
					return;
				}
				
				let row = table.insertRow(); // Insert new row
				let allCells = getNextRow(position);
				// Add 8 cells
				for (let i = 0; i<8; i++)
				{
					let cell = row.insertCell();
				
					cell.innerHTML = allCells[i];
				}
			}
        };
		
		function DESTROY()
		{
			let rows = table.getElementsByTagName("tr").length;
			
			for (let i = 0; i<rows; i++)
			{
				table.deleteRow(0);
			}
		};
		
		function getNextRow(position) {
			// Returns array, each index next cell
			let row = [];
			for (let i = 0; i<8; i++)
			{
				row.push(displayInfo[i][position]);
			}
			return row;
		};
		
		function changeSize()
		{
			DESTROY();
			size = document.getElementById("table-size").value - 0;
			createTable();
		};
		
		window.addEventListener('load', event => {	
				loadDoc();
				displayInfo = allInformation;
				createTable();	
		});
    </script>
</html>

